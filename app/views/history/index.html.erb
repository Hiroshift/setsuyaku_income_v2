<!-- これまでの節約収入 -->
<div class="hist-hero">
  <p class="hist-hero-label">これまでの節約収入</p>
  <p class="hist-hero-value">¥<%= number_with_delimiter(@total_income) %></p>
  <% if @total_minutes > 0 %>
    <p class="hist-hero-eq">＝ <%= @lifetime_display %>ぶんの労働</p>
  <% end %>
  <p class="hist-hero-meta"><%= @days_since_start %>日間の記録</p>
</div>

<% if current_user.premium? %>
  <!-- これだけの人生でできること（プレミアム） -->
  <% if @life_equivalents.any? %>
    <div class="hist-equiv">
      <p class="hist-equiv-intro">この労働時間ぶんで</p>
      <% @life_equivalents.each do |eq| %>
        <div class="hist-equiv-row">
          <span class="hist-equiv-text"><%= eq[:text] %></span>
          <span class="hist-equiv-count"><%= eq[:count] %>回</span>
        </div>
      <% end %>
    </div>
  <% end %>

  <hr class="sep">

  <!-- 月別のあゆみ（プレミアム） -->
  <% if @months.any? %>
    <div class="hist-section">
      <p class="hist-heading">月別のあゆみ</p>

      <% @months.each do |m| %>
        <div class="hist-month">
          <div class="hist-month-head">
            <span class="hist-month-label"><%= m[:label] %></span>
            <span class="hist-month-time"><%= m[:time] %></span>
          </div>
          <div class="hist-bar-track">
            <div class="hist-bar-fill" style="width: <%= m[:percent] %>%"></div>
          </div>
          <span class="hist-month-amount">¥<%= number_with_delimiter(m[:amount]) %></span>
        </div>
      <% end %>
    </div>

    <hr class="sep">
  <% end %>
<% end %>

<!-- 最近の記録（全ユーザー共通） -->
<% if @recent.any? %>
  <div class="hist-section">
    <p class="hist-heading">最近の記録</p>

    <div class="hist-list">
      <% @recent.each do |r| %>
        <div class="hist-row">
          <span class="hist-row-date"><%= r[:date].strftime("%-m/%-d") %></span>
          <span class="hist-row-body">
            <span class="hist-row-main">
              <span class="hist-row-amount">¥<%= number_with_delimiter(r[:amount]) %></span>
              <span class="hist-row-arrow">→</span>
              <span class="hist-row-time"><%= r[:time] %></span>
            </span>
            <% if r[:note].present? %>
              <span class="hist-row-note"><%= r[:note] %></span>
            <% end %>
          </span>
          <%= button_to recording_path(r[:id]), method: :delete,
                class: "hist-row-del",
                data: { turbo_confirm: "¥#{number_with_delimiter(r[:amount])}の記録を取り消しますか？" } do %>
            ×
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<% unless current_user.premium? %>
  <hr class="sep">
  <%= render "shared/premium_gate" %>
<% end %>

<%= link_to "← ホーム", root_path, class: "back-link" %>
