<% if user_signed_in? %>

  <div class="record" data-controller="amount">
    <p class="record-q">いくら節約しましたか？</p>
    <p class="record-display" data-amount-target="display">¥0</p>

    <%= form_with url: new_income_path, method: :post, local: true do |f| %>
      <%= f.hidden_field :amount, value: "", data: { amount_target: "hidden" } %>

      <div class="keypad">
        <button type="button" class="key" data-key="1" data-action="amount#press">1</button>
        <button type="button" class="key" data-key="2" data-action="amount#press">2</button>
        <button type="button" class="key" data-key="3" data-action="amount#press">3</button>
        <button type="button" class="key" data-key="4" data-action="amount#press">4</button>
        <button type="button" class="key" data-key="5" data-action="amount#press">5</button>
        <button type="button" class="key" data-key="6" data-action="amount#press">6</button>
        <button type="button" class="key" data-key="7" data-action="amount#press">7</button>
        <button type="button" class="key" data-key="8" data-action="amount#press">8</button>
        <button type="button" class="key" data-key="9" data-action="amount#press">9</button>
        <button type="button" class="key key--sub" data-key="00" data-action="amount#press">00</button>
        <button type="button" class="key" data-key="0" data-action="amount#press">0</button>
        <button type="button" class="key key--sub" data-action="amount#del">←</button>
      </div>

      <%= f.submit "時間に変える", class: "record-btn" %>
    <% end %>
  </div>

  <hr class="sep">

  <div class="today">
    <div class="today-item">
      <span class="today-num">¥<%= number_with_delimiter(@today_income) %></span>
      <span class="today-sub">今日の節約収入</span>
    </div>
    <div class="today-item">
      <span class="today-num"><%= @virtual_work_time %></span>
      <span class="today-sub">取り戻した時間</span>
    </div>
  </div>

  <% if @lifetime_minutes > 0 %>
    <hr class="sep">

    <div class="life">
      <p class="life-above">取り戻した人生</p>
      <p class="life-num"><%= @lifetime_display %></p>
      <p class="life-below">
        累計 ¥<%= number_with_delimiter(@total_income) %>
        <% if current_user.premium? && @annual_projection.present? %>
          · 年末まで<%= @annual_projection %>ペース
        <% end %>
      </p>
    </div>

    <% if current_user.premium? && @total_minutes > 0 %>
      <%= turbo_frame_tag "ai_suggestion" do %>
        <%= button_to "この時間の使い方をAIに聞く →", suggest_path,
              class: "ai-text-link",
              data: { turbo_frame: "ai_suggestion" } %>
      <% end %>
    <% end %>
  <% else %>
    <hr class="sep">

    <div class="life">
      <p class="life-above">累計の節約収入</p>
      <p class="life-num life-num--plain">¥<%= number_with_delimiter(@total_income) %></p>
    </div>
  <% end %>

  <% unless current_user.premium? %>
    <hr class="sep">
    <%= render "shared/premium_gate" %>
  <% end %>

<% else %>

  <div class="hero">
    <p class="hero-kicker">あなたの1時間は、</p>
    <h2 class="hero-big">いくらですか？</h2>
    <p class="hero-body">
      節約したお金は「収入」になる。
      そして、その収入は「自由な時間」に変わる。
    </p>

    <div class="hero-ex">
      <p class="hero-ex-line">コンビニ弁当をやめて自炊した</p>
      <p class="hero-ex-line hero-ex-strong">→ ¥500の収入。25分の自由を、取り戻した。</p>
    </div>

    <%= link_to "自分の時間を知る", new_user_registration_path, class: "hero-cta" %>

    <ul class="hero-notes">
      <li>節約した金額をサッと入力</li>
      <li>あなたの時給で「時間」に換算</li>
      <li>取り戻した人生が見えてくる</li>
    </ul>
  </div>

<% end %>
