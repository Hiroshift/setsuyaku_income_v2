<% if user_signed_in? %>

  <div class="record" data-controller="amount">
    <p class="record-q">いくら節約しましたか？</p>
    <p class="record-display" data-amount-target="display">¥0</p>

    <%= form_with url: new_income_path, method: :post, local: true do |f| %>
      <%= f.hidden_field :amount, value: "", data: { amount_target: "hidden" } %>

      <div class="keypad">
        <button type="button" class="key" data-key="1" data-action="amount#press">1</button>
        <button type="button" class="key" data-key="2" data-action="amount#press">2</button>
        <button type="button" class="key" data-key="3" data-action="amount#press">3</button>
        <button type="button" class="key" data-key="4" data-action="amount#press">4</button>
        <button type="button" class="key" data-key="5" data-action="amount#press">5</button>
        <button type="button" class="key" data-key="6" data-action="amount#press">6</button>
        <button type="button" class="key" data-key="7" data-action="amount#press">7</button>
        <button type="button" class="key" data-key="8" data-action="amount#press">8</button>
        <button type="button" class="key" data-key="9" data-action="amount#press">9</button>
        <button type="button" class="key key--sub" data-key="00" data-action="amount#press">00</button>
        <button type="button" class="key" data-key="0" data-action="amount#press">0</button>
        <button type="button" class="key key--sub" data-action="amount#del">←</button>
      </div>

      <%= f.submit "収入に変換する", class: "record-btn" %>
    <% end %>
  </div>

  <hr class="sep">

  <div class="today">
    <div class="today-item">
      <span class="today-num">¥<%= number_with_delimiter(@today_income) %></span>
      <span class="today-sub">今日の節約収入</span>
    </div>
    <div class="today-item">
      <span class="today-num"><%= @virtual_work_time %></span>
      <span class="today-sub">取り戻した時間</span>
    </div>
  </div>

  <% if @lifetime_minutes > 0 %>
    <hr class="sep">

    <div class="life">
      <p class="life-above">取り戻した人生</p>
      <p class="life-num"><%= @lifetime_display %></p>
      <p class="life-below">
        累計 ¥<%= number_with_delimiter(@total_income) %><% if @annual_projection.present? %> · 年末まで<%= @annual_projection %>ペース<% end %>
      </p>
    </div>

    <% if @total_minutes > 0 %>
      <%= turbo_frame_tag "ai_suggestion" do %>
        <%= button_to "この時間の使い方をAIに聞く →", suggest_path,
              class: "ai-text-link",
              data: { turbo_frame: "ai_suggestion" } %>
      <% end %>
    <% end %>
  <% else %>
    <hr class="sep">

    <div class="life">
      <p class="life-above">累計の節約収入</p>
      <p class="life-num life-num--plain">¥<%= number_with_delimiter(@total_income) %></p>
    </div>
  <% end %>

<% else %>

  <div class="hero">
    <p class="hero-kicker">節約は、</p>
    <h2 class="hero-big">収入だ。</h2>
    <p class="hero-body">
      節約した金額を「収入」と「取り戻した時間」に変換。
      毎日の小さな節約が、どれだけの価値か実感できます。
    </p>

    <div class="hero-ex">
      <p class="hero-ex-line">コンビニ弁当を自炊に変えて ¥500 節約</p>
      <p class="hero-ex-line hero-ex-strong">→ ¥500 の収入、25分の自由を取り戻した</p>
    </div>

    <%= link_to "無料ではじめる", new_user_registration_path, class: "hero-cta" %>

    <ul class="hero-notes">
      <li>節約金額をサッと記録</li>
      <li>あなたの時給で「時間」に変換</li>
      <li>取り戻した人生を可視化</li>
    </ul>
  </div>

<% end %>
